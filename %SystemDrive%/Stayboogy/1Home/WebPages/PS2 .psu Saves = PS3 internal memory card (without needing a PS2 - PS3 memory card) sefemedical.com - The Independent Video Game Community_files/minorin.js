/**
 * Minorin 0.0.5
 * Modified for XenForo 1.4.x by GBAtemp.net
 */
function getCurrentMessageBox(){return 0==$(".InlineMessageEditor:visible").length?$(".minorin_toolbar + textarea:visible").filter(function(){return 0==$(this).parents(".InlineMessageEditor").length}):$(".InlineMessageEditor textarea[name='message']:visible")}function getCaretPosition(e){var t=0;if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}function getCaretLength(e){var t=0;if(document.selection){e.focus();var n=document.selection.createRange();t=n.text.length}else(e.selectionEnd||"0"==e.selectionEnd)&&(t=e.selectionEnd-e.selectionStart);return t}function setCaretPosition(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}}jQuery.fn.extend({minorinSetup:function(e){return this.each(function(){(e||$(this).parent().hasClass("bbCodeEditorContainer")||1==$(this).parent().siblings("#minorin_toolbar_container").length)&&0==$(this).siblings(".minorin_toolbar").length&&0==$(this).siblings(".redactor_toolbar").length&&($(this).parent().prepend($("#minorin_toolbar_container:first > .minorin_toolbar").clone(!0)),$(".minorin_Popup").filter(function(){return 0==$(this).parents("#minorin_toolbar_container").length}).addClass("Popup"),XenForo.register(".Popup","XenForo.PopupMenu","XenForoActivatePopups"),XenForo.activate(document))})}}),jQuery.fn.extend({insertAroundCaret:function(e,t){return this.each(function(n){if(document.selection)this.focus(),sel=document.selection.createRange(),sel.text=e+sel.text+t,this.focus();else if(this.selectionStart||"0"==this.selectionStart){var i=this.selectionStart,o=this.selectionEnd,s=this.scrollTop;this.value=this.value.substring(0,i)+e+this.value.substring(i,o)+t+this.value.substring(o,this.value.length),this.focus(),this.selectionStart=i+e.length+t.length+(o-i),this.selectionEnd=i+e.length+t.length+(o-i),this.scrollTop=s}else this.value+=e+t,this.focus()})}}),$(document).ready(function(){$(".minorin_bbcode").live("click",function(e){e.preventDefault(),e.stopPropagation();var t=getCurrentMessageBox(),n=$(this).attr("data-code"),i=n.length,o=getCaretLength(t.get(0))>0;return t.insertAroundCaret(n.substring(0,n.indexOf("][")+1),n.substring(n.indexOf("][")+1,n.length)),i=-1!=n.indexOf("=][")?n.indexOf("=][")+1:n.indexOf("][")+1,o?setCaretPosition(t.get(0),getCaretPosition(t.get(0))+n.length-i):setCaretPosition(t.get(0),getCaretPosition(t.get(0))-(n.length-i)),!1}),$("textarea").live("focus",function(){$(this).minorinSetup(!1)}),0==$("#QuickReply > div:first > textarea").minorinSetup(!0).length&&$("#ctrl_message").minorinSetup(!0)});