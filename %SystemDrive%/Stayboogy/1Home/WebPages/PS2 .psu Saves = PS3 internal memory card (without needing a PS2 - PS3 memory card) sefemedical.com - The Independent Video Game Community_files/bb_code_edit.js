/*
 * XenForo bb_code_edit.min.js
 * Copyright 2010-2018 XenForo Ltd.
 * Released under the XenForo License Agreement: http://xenforo.com/license-agreement
 */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(d,k,n){d instanceof String&&(d=String(d));for(var p=d.length,b=0;b<p;b++){var c=d[b];if(k.call(n,c,b,d))return{i:b,v:c}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,k,n){d!=Array.prototype&&d!=Object.prototype&&(d[k]=n.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,k,n,p){if(k){n=$jscomp.global;d=d.split(".");for(p=0;p<d.length-1;p++){var b=d[p];b in n||(n[b]={});n=n[b]}d=d[d.length-1];p=n[d];k=k(p);k!=p&&null!=k&&$jscomp.defineProperty(n,d,{configurable:!0,writable:!0,value:k})}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,n){return $jscomp.findInternal(this,d,n).v}},"es6","es3");
!function(c,b,a,d){XenForo.BbCodeWysiwygEditor=function(e){this.__construct(e)};XenForo.BbCodeWysiwygEditor.prototype={__construct:function(j){this.$textarea=j;this.options=j.data("options")||{};this.dialogUrl=j.data("dialog-url")?XenForo.canonicalizeUrl(j.data("dialog-url"),XenForo.ajaxBaseHref):"index.php?editor/dialog";this.autoSaveUrl=j.data("auto-save-url");this.autoCompleteUrl=j.data("ac-url")||XenForo.AutoComplete.getDefaultUrl();this.pasteImageCounter=1;var i=j.attr("id");if(i){var g=XenForo.BbCodeWysiwygEditor_EXTEND[i];
if(g){if(typeof g=="function"){this.options=g(this.options,this)}else{this.options=c.extend(this.options,g)}}}var e=this._adjustButtonConfig(this.getButtonConfig(),this.options.buttons||{}),h=this.getExecHandlers(),f=j.data("css-url");this.editorConfig=c.extend({direction:c("html").attr("dir")||"ltr",formattingTags:[],source:false,iframe:true,iframeBase:XenForo.baseUrl(),lang:"xf",buttons:e.buttons,css:f?XenForo.canonicalizeUrl(f,XenForo.ajaxBaseHref):false,buttonsCustom:e.buttonsCustom,execCommandHandler:h,modal_link:{url:this.dialogUrl+"&dialog=link"},modal_image:{url:this.dialogUrl+"&dialog=image"},observeImages:false,allowJustify:false,cleanupFontTags:false,convertLinks:false,modalCreateCallback:c.context(this,"modalCreateCallback"),callback:c.context(this,"editorInit"),pastePreventCallback:c.context(this,"pastePreventCallback"),pasteManipulateCallback:c.context(this,"pasteManipulateCallback"),pasteCleanUpCallback:c.context(this,"pasteCleanUpCallback"),insertHtmlCallback:c.context(this,"insertHtmlCallback")},this.options.editorOptions||{});
c(a).triggerHandler("EditorInit",{editor:this,config:this.editorConfig,$textarea:j});j.css("visibility","").show();j.redactor(this.editorConfig)},getButtonConfig:function(){var m=this,i=[["switchmode"],["removeformat"],["bbcodehelp"]],n=this.options.buttonConfig,k;if(!n||n.basic){i.push(["bold","italic","underline"])}if(!n||n.extended){i.push(["fontcolor","fontsize","fontfamily"])}if(!n||n.link){i.push(["createlink","unlink"])}if(!n||n.align){i.push(["alignment"])}if(!n||n.list){i.push(["unorderedlist","orderedlist","outdent","indent"])
}else{if(n.indent){i.push(["outdent","indent"])}}k=[];if(!n||n.smilies){k.push(["smilies"])}if(!n||n.image){k.push("image")}if(!n||n.media){k.push("media")}if(!n||n.block){k.push("insert")}if(k.length){i.push(k)}k=[];if(!n||n.sosbbcode){k.push("sosbbcode")}if(this.options.bbCodes){c.each(this.options.bbCodes,function(q,p){if(!n||n[q]){k.push("custom_"+q)}})}if(k.length){i.push(k)}if(this.autoSaveUrl){i.push(["draft"])}i.push(["undo","redo"]);var j={Arial:"arial,helvetica,sans-serif","Book Antiqua":"'book antiqua',palatino,serif","Courier New":"'courier new',courier,monospace",Georgia:"georgia,palatino,serif",Tahoma:"tahoma,arial,helvetica,sans-serif","Times New Roman":"'times new roman',times,serif","Trebuchet MS":"'trebuchet ms',geneva,sans-serif",Verdana:"verdana,geneva,sans-serif"};
var o={"1":"9px","2":"10px","3":"12px","4":"15px","5":"18px","6":"22px","7":"26px"};var f=function(p,r,q){p.focus();var s=c(p.analyzeSelection().selectedEls);s.find("[style]").css("font-size","");s.filter("[style]").css("font-size","");p.execCommand("fontsize",q)};var g=function(p,r,q){p.focus();var s=c(p.analyzeSelection().selectedEls);s.find("[style]").css("font-family","");s.filter("[style]").css("font-family","");p.execCommand("fontname",q)};var h={},l={};c.each(j,function(q,p){h[q]={title:q,callback:g,style:"font-family: "+p}
});c.each(o,function(q,p){l[q]={title:q,callback:f,style:"font-size: "+p}});var e={switchmode:{title:this.getText("switch_mode_bb"),callback:c.context(this,"wysiwygToBbCode")},removeformat:{title:this.getText("remove_formatting"),exec:"removeformat"},bbcodehelp:{title:"Open BB Code Help",callback:function(p){b.open("/help/bb-codes","_blank")}},fontsize:{title:this.getText("font_size"),func:"show",dropdown:l},fontfamily:{title:this.getText("font_family"),func:"show",dropdown:h},smilies:{title:this.getText("smilies"),callback:c.context(this,"toggleSmilies")},createlink:{title:this.getText("link"),callback:c.context(this,"getLinkModal")},unlink:{title:this.getText("unlink"),exec:"unlink"},image:{title:this.getText("image"),callback:c.context(this,"getImageModal")},media:{title:this.getText("media"),callback:c.context(this,"getMediaModal")},draftsave:{title:this.getText("save_draft"),callback:c.proxy(function(){this.saveDraft(true);
this.api.focus()},this),className:"icon saveDraft"},draftdelete:{title:this.getText("delete_draft"),callback:c.proxy(function(){this.saveDraft(true,true);this.api.focus()},this),className:"icon deleteDraft"},draft:{title:this.getText("drafts"),func:"show",dropdown:{}},undo:{title:this.getText("undo"),exec:"undo"},redo:{title:this.getText("redo"),exec:"redo"},alignment:{title:this.getText("alignment"),func:"show",dropdown:{alignleft:{title:this.getText("align_left"),exec:"JustifyLeft",className:"icon alignLeft"},aligncenter:{title:this.getText("align_center"),exec:"JustifyCenter",className:"icon alignCenter"},alignright:{title:this.getText("align_right"),exec:"JustifyRight",className:"icon alignRight"}}},insertquote:{title:this.getText("quote"),callback:function(p){m.wrapSelectionInHtml(p,"[QUOTE]","[/QUOTE]",true)
},className:"icon quote"},insertspoiler:{title:this.getText("spoiler"),callback:c.context(this,"getSpoilerModal"),className:"icon spoiler"},insertcode:{title:this.getText("code"),callback:c.context(this,"getCodeModal"),className:"icon code"},insert:{title:this.getText("insert"),func:"show",dropdown:{}},sosbbcode:{title:"Boxes",func:"show",dropdown:{}}};e.draft.dropdown={save:e.draftsave,"delete":e.draftdelete};e.insert.dropdown={quote:e.insertquote,spoiler:e.insertspoiler,code:e.insertcode,deleted:{title:this.getText("deleted"),exec:"StrikeThrough",className:"icon strikethrough"}};
if(this.options.bbCodes){c.each(this.options.bbCodes,function(q,p){var r=q.toUpperCase();if(["error","warning","success","information"].indexOf(q)>-1){e.sosbbcode.dropdown[q]={title:p.title.substring(0),callback:function(s){m.wrapSelectionInHtml(s,"["+r+"]","[/"+r+"]",true)},className:"icon sos"+q}}else{e["custom_"+q]={title:p.title,callback:function(s){if(p.hasOption=="yes"){m.wrapSelectionInHtml(s,"["+r+"=]","[/"+r+"]",true)}else{m.wrapSelectionInHtml(s,"["+r+"]","[/"+r+"]",true)}}}}})}return{buttons:i,buttonsCustom:e}},_adjustButtonConfig:function(g,j){var f=this,e=[];
for(var h in j){if(!j.hasOwnProperty(h)){continue}(function(l){var k=j[l];g.buttonsCustom[l]={title:f.getText(l,k.title),callback:function(m){if(k.exec){m.execCommand(k.exec)}else{if(k.tag){var i=k.tag;f.wrapSelectionInHtml(m,"["+i+"]","[/"+i+"]",true)}}}};e.push(l)})(h)}if(e.length){g.buttons.push(e)}return g},getExecHandlers:function(){return{}},editorInit:function(h){this.api=h;var g=this,f=h,e=f.$editor,i=e.closest("body"),j=e.closest("html");"undefined"!=typeof savedStyleName&&"default"!=savedStyleName&&(j.addClass("customStyle preset_"+savedStyleName),i.css({"background-color":c(a.body).css("background-color"),color:c(a.body).css("color")}));if(c.browser.msie){i.click(function(k){k.stopPropagation()});j.click(function(){f.focus();
var k=f.getSelection();k.collapse(1)})}e.on("cut copy",c.context(this,"editorCutCopyCallback"));c.each(["switchmode","removeformat","bbcodehelp"],function(l,k){var n=h.getBtn(k),m=n.closest(".redactor_btn_group");if(!m.length){m=n.parent()}m.addClass("redactor_btn_right")});e.on("click","img",function(l){f.focus();if(c(this).hasClass("mceSmilie")||c(this).hasClass("mceSmilieSprite")||c(this).hasClass("attachFull")||c(this).hasClass("attachThumb")){l.preventDefault();return}var m=0,k=this;while(k.previousSibling){m++;k=k.previousSibling
}f.setSelection(this.parentNode,m,this.parentNode,m+1);g.getImageModal(f)});e.on("click","a",function(k){k.preventDefault()});this.initFocusWatch();this.initPlaceholder();this.initElastic();this.initDragDrop();this.initAutoComplete();if(this.autoSaveUrl){setTimeout(function(){g.initAutoSave()},0)}this.$textarea.closest("form").submit(function(){h.syncCode()})},editorCutCopyCallback:function(l){var g=this.api,j=g.$editor;var m=g.analyzeSelection();if(m.isCollapsed){return}var i=g.getSelectedHtml();i=i.replace(/<p/gi,'<div data-redactor="1"').replace(/<\/p>/gi,"</div>");
if(!g.browser("msie")){i=i.replace(/<(p|div)[^>]><\/(p|div)>/gi,"")}i=i.replace(/<font/gi,'<font data-redactor="1"');var f=c('<div data-redactor-wrapper="1" />').html(i).css({position:"absolute",left:"-9999px"});if(!i.match(/<(article|blockquote|dd|div|dl|fieldset|form|h\d|header|hr|ol|p|pre|section|table|ul)/)){m.$commonAncestor.parents().addBack().filter("b, strong, i, em, u, s, span, strike, font").each(function(){f.append(c(this.cloneNode(false)).append(f[0].childNodes))});if(i.match(/^\s*<li/)){m.$commonAncestor.parents().addBack().filter("ul, ol").first().each(function(){f.append(c(this.cloneNode(false)).append(f[0].childNodes))
})}}if(l.type=="cut"){g.pasteHtmlAtCaret("");g.formatEmpty()}g.saveSelection();j.append(f);var k=g.getSelection();try{k.selectAllChildren(f.get(0))}catch(l){if(this.api.document.createRange&&k.removeAllRanges&&k.addRange){var h=this.api.document.createRange();h.selectNode(f.get(0));k.removeAllRanges();k.addRange(h)}else{if(k.moveToElementText){k.moveToElementText(f.get(0));k.select()}}}setTimeout(function(){f.remove();g.restoreSelection()},0)},initFocusWatch:function(){var g=this.api,f=this,h;g.$editor.on("focus click",function(i){if(h){clearTimeout(h);
h=null}g.$box.addClass("focused");c(g.$box[0].ownerDocument).trigger("HideAllMenus")});g.$editor.on("blur",function(i){h=setTimeout(function(){g.$box.removeClass("focused")},200)});g.$editor.on("focus click keypress",function(){if(!f.editorActivated){g.$box.addClass("activated");f.editorActivated=true}});if(g.isMobile(true)){var e=b.innerHeight;c(b).on("resize",function(){if(g.$box.hasClass("focused")&&b.innerHeight<e){setTimeout(function(){if(c(b).scrollTop()!=0){return}var i=g.getFocus()[0];if(i){g.$editor[0].scrollIntoView();
i.scrollIntoView?i.scrollIntoView():i.parentNode.scrollIntoView()}},50)}e=b.innerHeight})}},initPlaceholder:function(){if(!this.options.placeholder){return}var f=this.api,e=this;if(!this.$placeholder){this.$placeholder=c('<div class="placeholder" />').append(c("<span />").text(this.getText(this.options.placeholder)));f.$content.before(this.$placeholder);this.$placeholder.click(function(){f.focus()})}this.placeholderVisible=false;f.$editor.on("focus click keydown",function(){if(e.placeholderVisible){e.$placeholder.hide();e.placeholderVisible=false
}});if(f.$editor.html().match(/^$|(^\s*<p>(\s|&nbsp;|<br\s*\/?>)*<\/p>\s*$)/i)){this.$placeholder.show();this.placeholderVisible=true}},initElastic:function(){var h=this.api;var m=h.$box.find("iframe"),k=c(b).height()-200,l=h.$el.outerHeight(),j=h.$editor[0],i=0,g,f=(c.browser.msie&&c.browser.version<9);if(m.closest(".xenOverlay").length){k-=175}k=Math.max(k,l);this.minHeight=l;this.maxHeight=k;if(h.isMobile(true)){var e=function(){var o=h.$box.width();if(o){c(j.ownerDocument.documentElement).width(o)}};e();h.$editor.on("focus",e);
c(b).on("orientationchange resize",function(){setTimeout(e,0)});h.$editor.addClass("noElastic");m.height(Math.max(Math.min(175,b.innerHeight/2),l));return}g=function(){if(!m){return}h.$editor.css("min-height","");var o=f?j.scrollHeight:Math.min(j.offsetHeight,j.scrollHeight);h.$editor.css("min-height",l-1);if(o<j.clientHeight||c.browser.msie){o+=22}if(o<l){o=l}else{if(o>k){o=k}}if(o!=i){if(!f){if(i<o&&o==k){h.$editor.css("overflow-y","")}else{if(i==k&&o<k){h.$editor.css("overflow-y","hidden")}}}m.height(o);i=o}};var n;h.$editor.on("paste change keydown focus click drop",function(){if(n){return
}n=setTimeout(function(){n=null;g()},100)});h.$editor.data("xenForoElastic",g);if(!f){h.$editor.css("overflow-y","hidden")}if(!h.browser("msie")){h.$editor.on("drop",function(o){h.$editor.css("display","block");setTimeout(function(){h.$editor.css("display","")},0)})}g();setTimeout(g,250);this.watchImagesElastic();c(b).focus(g)},triggerElastic:function(){if(!this.$textarea.data("redactor")){return}var e=this.api,f=e.$editor.data("xenForoElastic");if(f){f()}},watchImagesElastic:function(f){var i=(f===false||typeof f=="undefined")?this.api.$editor:c(f),e,g=this,h=function(){if(e){clearTimeout(e)
}e=setTimeout(function(){g.triggerElastic()},100)};i.find("img").one("load",h);i.filter("img").one("load",h)},resetEditor:function(f,h){if(!this.$textarea.data("redactor")){return}var e=this.api;if(!f){f=e.opts.emptyHtml}e.setCode(f,false);e.observeFormatting();this.resetAutoSave();this.initPlaceholder();e.$box.find(".redactor_smilies").hide();e.$box.removeClass("activated");this.editorActivated=false;var g=e.$editor.data("xenForoElastic");if(g){g()}if(h){this.blurEditor()}},blurEditor:function(){if(!this.$textarea.data("redactor")){return
}var f=this.api,e=f.$editor;if(f.opts.iframe&&e[0]){var g=e[0].ownerDocument;if(g){(g.defaultView||g.parentWindow).focus()}}if(!c.browser.msie){e.blur()}},initDragDrop:function(){if(this.api.isMobile(true)||this.$textarea.hasClass("NoAttachment")){return}var g=this.api;var h=function(){i.removeClass("hover")},j=g.$box.closest("form").find(".AttachmentUploader"),e=(j.length>0),k;var i=c('<div class="redactor_editor_drop" />');i.append(c("<span />").text(this.getText(e?"drop_files_here_to_upload":"uploads_are_not_available"))).appendTo(g.$box);
if(!e){i.addClass("dragDisabled")}var f=function(m){var l=m.originalEvent.dataTransfer;if(!l||typeof l.files=="undefined"){return false}if(l.types&&(c.inArray("Files",l.types)==-1||l.types[0]=="text/x-moz-url")){return false}l.dropEffect="copy";return true};c([a,g.document]).on("dragover",function(l){if(!f(l)){return}i.addClass("hover");clearTimeout(k);k=setTimeout(h,200)});i.on("dragover",function(l){if(!f(l)){return}l.preventDefault()});i.on("drop",function(q){q.preventDefault();clearTimeout(k);h();if(!e){return}var p=q.originalEvent.dataTransfer;
var l=function(r,u){try{var s=new FormData();s.append("upload",r);s.append("_xfToken",XenForo._csrfToken);s.append("_xfNoRedirect","1");j.find(".HiddenInput").each(function(){var v=c(this);s.append(v.data("name"),v.data("value"))})}catch(t){return}c.ajax({url:j.data("action"),method:"POST",dataType:"json",data:s,processData:false,contentType:false}).done(function(v){if(!XenForo.hasResponseError(v)){j.trigger({type:"AttachmentUploaded",ajaxData:v})}}).fail(function(x){try{var v=c.parseJSON(x.responseText);if(v&&XenForo.hasResponseError(v)){}}catch(w){}}).always(function(){if(u){u()
}})};if(p&&p.files&&p.files.length){var o=p.files,m=0;var n=function(){var r=o[m];if(r){m++;l(r,n)}};n()}})},initAutoComplete:function(){if(this.$textarea.hasClass("NoAutoComplete")){return}var i=this.api,g=i.$editor,j=g[0].ownerDocument,h=this,f,e=function(){if(f){return}f=setTimeout(function(){h.acResults.hideResults();f=null},200)};this.acVisible=false;this.acResults=new XenForo.AutoCompleteResults({onInsert:c.context(this,"insertAutoComplete")});c(j.defaultView||j.parentWindow).on("scroll",e);g.on("click blur",e);g.on("keydown",function(m){var k=true,l=h.acResults;
if(!l.isVisible()){return}switch(m.keyCode){case 40:l.selectResult(1);break;case 38:l.selectResult(-1);break;case 27:l.hideResults();break;case 13:l.insertSelectedResult();break;default:k=false}if(k){m.stopPropagation();m.stopImmediatePropagation();m.preventDefault()}});g.data("events").keydown.reverse();g.on("keyup",function(l){var k=h.findCurrentAutoCompleteOption();if(k){h.triggerAutoComplete(k)}else{h.hideAutoComplete()}})},findCurrentAutoCompleteOption:function(){var h=this.api,e=h.getFocus(),f=h.getOrigin();if(!e||!f||e[0]!=f[0]||e[1]!=f[1]){return false
}var j=c(e[0]),i=e[0].nodeType==3?j.text().substring(0,e[1]):c(j.contents().get(e[1]-1)).text(),k=i.lastIndexOf("@");if(k!=-1&&(k==0||i.substr(k-1,1).match(/(\s|[\](,]|--)/))){var g=i.substr(k+1);if(!g.match(/\s/)||g.length<=10){g=g.replace(new RegExp(String.fromCharCode(160),"g")," ");return g}}return false},insertAutoComplete:function(f){this.api.focus();var g=this.api,e=g.getFocus(),i=c(e[0]),h;if(e[0].nodeType==3){h=i.text().substring(0,e[1])}else{e[0]=i.contents().get(e[1]-1);i=c(e[0]);h=i.text()}var j=h.lastIndexOf("@");
if(j!=-1){g.setSelection(e[0],j,e[0],h.length);g.insertHtml("@"+XenForo.htmlspecialchars(f)+"&nbsp;");this.lastAcLookup=f+" "}g.focus()},triggerAutoComplete:function(e){if(this.lastAcLookup&&this.lastAcLookup==e){return}this.hideAutoComplete();this.lastAcLookup=e;if(e.length>2&&e.substr(0,1)!="["){this.acLoadTimer=setTimeout(c.context(this,"autoCompleteLookup"),200)}},autoCompleteLookup:function(){if(this.acXhr){this.acXhr.abort()}this.acXhr=XenForo.ajax(this.autoCompleteUrl,{q:this.lastAcLookup},c.context(this,"showAutoCompleteResults"),{global:false,error:false})
},showAutoCompleteResults:function(e){this.acXhr=false;if(this.lastAcLookup!=this.findCurrentAutoCompleteOption()){return}var i=this.api,j=i.$box.find("iframe"),l=j.offset(),g=i.getFocus()[0],k=g.nodeType==3?c(g).parent():c(g),f=k.offset();var h={top:l.top+f.top+k.height()-i.$editor.scrollTop(),left:l.left};if(XenForo.isRTL()){h.right=c("html").width()-l.left-j.outerWidth();h.left="auto"}this.acResults.showResults(this.lastAcLookup,e.results,j,h)},hideAutoComplete:function(){this.acResults.hideResults();if(this.acLoadTimer){clearTimeout(this.acLoadTimer);
this.acLoadTimer=false}},syncEditor:function(){if(this.$textarea&&this.$textarea.data("redactor")){this.$textarea.data("redactor").syncCode()}},initAutoSave:function(){var h=this.api,g=this,f=this.$textarea.closest("form");if(!f.length){return}this.lastAutoSaveContent=h.getCode();var e=setInterval(function(){if(!g.$textarea.data("redactor")){clearInterval(e);return}g.saveDraft()},(this.options.autoSaveFrequency||60)*1000)},saveDraft:function(i,f){var j=this.api,h=this,g=this.$textarea.closest("form"),k=j.$el.prop("disabled")?this.$bbCodeTextArea.val():j.getCode();
if(!f&&!i&&k==this.lastAutoSaveContent){return false}j.syncCode();this.lastAutoSaveContent=k;var l=c.Event("BbCodeWysiwygEditorAutoSave");l.editor=this;l.content=k;l.deleteDraft=f;g.trigger(l);if(l.isDefaultPrevented()){return false}if(this.autoSaveRunning){return false}this.autoSaveRunning=true;XenForo.ajax(this.autoSaveUrl,g.serialize()+(f?"&delete_draft=1":""),function(m){var p=c.Event("BbCodeWysiwygEditorAutoSaveComplete");p.ajaxData=m;g.trigger(p);if(!p.isDefaultPrevented()){var n=j.$box.find(".draftNotice");if(!n.length){n=c('<div class="draftNotice"><span></span></div>');
j.$content.after(n)}var q=n.find("span:first"),o;if(m.draftSaved){o=h.getText("draft_saved")}else{if(m.draftDeleted){o=h.getText("draft_deleted")}}if(o){q.text(o);n.finish().hide().fadeIn().delay(2000).fadeOut()}}},{global:false}).complete(function(){h.autoSaveRunning=false});return true},triggerAutoSave:function(){this.saveDraft(true)},triggerAutoSaveDelete:function(){this.saveDraft(true,true)},resetAutoSave:function(){if(this.$textarea.data("redactor")){var f=this.api,e=this.$textarea.closest("form");this.lastAutoSaveContent=f.$el.prop("disabled")?this.$bbCodeTextArea.val():f.getCode();
e.find(".draftUpdate .draftDeleted, .draftUpdate .draftSaved").finish().fadeOut()}},insertHtmlCallback:function(f){this.watchImagesElastic(f);var e=this;setTimeout(function(){e.triggerElastic()},300)},wrapSelectionInHtml:function(f,j,e,g){if(g){e='<ins class="selection"></ins>'+e}var h=f.getSelectedHtml();h=h.replace(/^(<p[^>]*>)?/,"$1"+j).replace(/(<\/p>)?$/,e+"$1");f.execCommand("inserthtml",h);f.syncCode();if(g){var i=f.$editor.find("ins.selection");if(i.length){f.setSelection(i[0],0,i[0],0);i.remove()}else{f.focus()}}},toggleSmilies:function(g){var f=this,e=g.$box.find(".redactor_smilies");
if(e.length){e.slideToggle();return}if(f.smiliesPending){return}f.smiliesPending=true;XenForo.ajax("index.php?editor/smilies",{},function(h){if(XenForo.hasResponseError(h)){return}if(h.templateHtml){new XenForo.ExtLoader(h,function(){e=c('<div class="redactor_smilies" />').html(h.templateHtml);e.hide();e.on("click",".Smilie",function(k){k.preventDefault();var j=c(this),i=c.trim(j.html());g.execCommand("inserthtml",i);g.focus()});g.$box.append(e);e.xfActivate();e.slideToggle()})}}).complete(function(){f.smiliesPending=false})},modalCreateCallback:function(f,g){g.addClass("xenOverlay");
var e=c('<form class="formOverlay xenForm" />').append(g.children()).appendTo(g);e.on("submit",function(h){h.preventDefault();e.find(".button.primary").click()});e.on("click","input[type=submit]",function(h){h.stopPropagation();h.preventDefault()});c("#redactor_modal_header").addClass("heading");return g},getLinkModal:function(g){var f=this;g.saveSelection();var h=g.getSelectedNode(),e;if(h){e=c(h).closest("a",g.$editor[0])}g.modalInit(this.getText("link"),{url:this.dialogUrl+"&dialog=link"},600,c.proxy(function(){var i=c("#redactor_link_url");
c("#redactor_insert_link_btn").click(function(j){j.preventDefault();setTimeout(function(){g.restoreSelection();var n=i.val();var m=g.analyzeSelection();if(n!==""){g.pushUndoStack();var l=n;if(n.match(/^(mailto|https?):/)){}else{if(n.match(/@[a-z0-9-]+\.[a-z0-9\.-]+$/i)){n="mailto:"+n}else{if(!n.match(/^https?:/i)){n="http://"+n}}}if(e&&e.length){var k=e.attr("href");e.attr("href",n);if(e.text()==k){e.text(n);g.setSelection(e[0],1,e[0],1)}}else{if(m.isCollapsed){g.pasteHtmlAtCaret('<a href="'+XenForo.htmlspecialchars(n)+'">'+XenForo.htmlspecialchars(l)+'</a><span class="AfterLink">&#x200b;</span>');
g.$editor.find(".AfterLink").remove()}else{g.execCommand("unlink","",false);g.execCommand("createlink",n,false)}}}else{if(e&&e.length){g.pushUndoStack();m.bookmarkSelection();e.after(e[0].childNodes);e.remove();m.restoreBookmark()}}g.syncCode();g.modalClose();g.focus()},150)});if(e&&e.length){i.val(e.attr("href").replace(/^mailto:/,""))}setTimeout(function(){i.focus()},100)},g))},getImageModal:function(f){var e=this;f.saveSelection();var g=f.getSelectedHtml(),h;if(g.match(/^\s*<img[^>]+src="([^"]+)"[^>]*>\s*$/)&&!g.match(/mceSmilie|attachFull|attachThumb/)){h=RegExp.$1;
h=c("<textarea>").html(h).text()}f.modalInit(this.getText("image"),{url:this.dialogUrl+"&dialog=image"},600,c.proxy(function(){var i=c("#redactor_image_link");c("#redactor_image_btn").click(function(j){j.preventDefault();f.restoreSelection();var k=i.val();if(k!==""){if(!k.match(/^https?:|ftp:/i)){k="http://"+k}f.pasteHtmlAtCaret('<img src="'+XenForo.htmlspecialchars(k)+'" alt="[IMG]" unselectable="on" />&nbsp;')}f.modalClose();f.observeImages();f.syncCode();f.focus()});if(h){i.val(h)}setTimeout(function(){i.focus()},100)},f))
},getMediaModal:function(f){var e=this;f.saveSelection();f.modalInit(this.getText("media"),{url:this.dialogUrl+"&dialog=media"},600,c.proxy(function(){c("#redactor_insert_media_btn").click(function(g){g.preventDefault();e.insertMedia(g,f)});setTimeout(function(){c("#redactor_media_link").focus()},100)},f))},insertMedia:function(g,f){XenForo.ajax("index.php?editor/media",{url:c("#redactor_media_link").val()},function(e){if(XenForo.hasResponseError(e)){return}if(e.matchBbCode){f.restoreSelection();f.execCommand("inserthtml",e.matchBbCode);
f.syncCode();f.modalClose()}else{if(e.noMatch){alert(e.noMatch)}}})},getCodeModal:function(f){var e=this;f.saveSelection();f.modalInit(this.getText("code"),{url:this.dialogUrl+"&dialog=code"},600,c.proxy(function(){c("#redactor_insert_code_btn").click(function(g){g.preventDefault();e.insertCode(g,f)});setTimeout(function(){c("#redactor_code_code").focus()},100)},f))},insertCode:function(j,h){var f,i,g;switch(c("#redactor_code_type").val()){case"html":f="HTML";break;case"php":f="PHP";break;default:f="CODE"}i=c("#redactor_code_code").val();
i=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\t/g,"    ").replace(/\n /g,"\n&nbsp;").replace(/  /g,"&nbsp; ").replace(/  /g," &nbsp;").replace(/\n/g,"</p>\n<p>");g="["+f+"]"+i+"[/"+f+"]";if(g.match(/\n/)){g="<p>"+g+"</p>";g=g.replace(/<p><\/p>/g,"<p>"+(!c.browser.msie?"<br>":"&nbsp;")+"</p>")}h.restoreSelection();h.execCommand("inserthtml",g);h.syncCode();h.modalClose()},getSpoilerModal:function(f){var e=this;f.saveSelection();f.modalInit(this.getText("spoiler"),{url:this.dialogUrl+"&dialog=spoiler"},600,c.proxy(function(){c("#redactor_insert_spoiler_btn").click(function(g){g.preventDefault();
e.insertSpoiler(g,f)});setTimeout(function(){c("#redactor_spoiler_title").focus()},100)},f))},insertSpoiler:function(h,g){var f=this,i=c("#redactor_spoiler_title").val();g.restoreSelection();if(i){f.wrapSelectionInHtml(g,'[SPOILER="'+XenForo.htmlspecialchars(i)+'"]',"[/SPOILER]",true)}else{f.wrapSelectionInHtml(g,"[SPOILER]","[/SPOILER]",true)}g.modalClose()},wysiwygToBbCode:function(f){var e=this,g=f.getCode();if(g.match(/^<p>(<br\s*\/?>|\s|&nbsp;)*<\/p>$/i)){e.wysiwygToBbCodeSuccess(f,{bbCode:""})}else{XenForo.ajax("index.php?editor/to-bb-code",{html:f.getCode()},function(h){e.wysiwygToBbCodeSuccess(f,h)
})}},wysiwygToBbCodeSuccess:function(j,g){if(XenForo.hasResponseError(g)||typeof(g.bbCode)=="undefined"){return}var t=j.$box,m=j.$el,i=c('<div class="bbCodeEditorContainer" />'),f=c('<textarea class="textCtrl Elastic" rows="5" />'),u=this;if(m.prop("disabled")){return}f.attr("name",m.attr("name").replace(/_html(]|$)/,"$1")).val(g.bbCode).appendTo(i);if(this.$textarea.hasClass("NoAttachment")){f.addClass("NoAttachment")}if(!c("#minorin_toolbar_container").length){c("<a />").attr("href","javascript:").text(this.getText("switch_mode_rich")).click(function(){u.bbCodeToWysiwyg(j)
}).appendTo(c("<div />").appendTo(i))}m.prop("disabled",true);if(j.browser("mozilla")){c(b).unbind("unload.rte").bind("unload.rte",function(){m.removeAttr("disabled")})}t.hide();i.insertAfter(t).xfActivate();f.focus();if(c("#minorin_toolbar_container").length){var h=c("<a>").attr("href","javascript:").attr("title","Use Rich Text Editor").addClass("redactor_btn_switchmode").click(function(){u.bbCodeToWysiwyg(j)});var s=c("<li>").append(h);var l=c("<ul>").append(s);var r=c("<li>").addClass("redactor_btn_group redactor_btn_right").append(l);
i.find(".minorin_toolbar > ul").prepend(r);if(u.autoSaveUrl){var k=c("<a>").attr("href","javascript:").attr("title","Save Draft").addClass("redactor_btn_draft").click(function(){u.saveDraft(true)});var p=c("<li>").append(k);var q=c("<a>").attr("href","javascript:").attr("title","Delete Draft").addClass("minorin_btn_deletedraft").click(function(){u.saveDraft(true,true)});var o=c("<li>").append(q);var n=c("<ul>").append(p).append(o);var e=c("<li>").addClass("redactor_btn_group").append(n);i.find(".minorin_toolbar > ul").append(e)
}}this.$bbCodeTextContainer=i;this.$bbCodeTextArea=f},bbCodeToWysiwyg:function(f){var e=this,g=this.$bbCodeTextArea.val();if(c.trim(g).length==0){this.bbCodeToWysiwygSuccess(f,{html:"<p>"+(!c.browser.msie?"<br />":"")+"</p>"})}else{XenForo.ajax("index.php?editor/to-html",{bbCode:this.$bbCodeTextArea.val()},function(h){e.bbCodeToWysiwygSuccess(f,h)})}},bbCodeToWysiwygSuccess:function(f,e){if(XenForo.hasResponseError(e)||typeof(e.html)=="undefined"){return}var h=f.$box,g=f.$el;if(!g.prop("disabled")){return}g.prop("disabled",false);
h.show();f.setCode(e.html);f.selectFirst();f.observeFormatting();this.$bbCodeTextContainer.remove()},pastePreventCallback:function(s,q,k){var h=k.originalEvent;if(!h.clipboardData){return}var p=h.clipboardData,u=p.items,r=p.types;if(!u||!r){return}for(var m=0;m<r.length;m++){if(r[m]=="text/html"){return}}var o=false;for(var n=0;n<u.length;n++){if(u[n].type.match(/^image\/([a-z0-9_-]+)$/i)){var g=u[n].getAsFile();var t=b.URL||b.webkitURL;var f=t.createObjectURL(g);var l=this.pasteImageCounter++;if(this.uploadPastedImage(q,l,RegExp.$1,g)){q.insertHtml('<img src="'+f+'" data-paste-id="'+l+'">');
o=true}}}if(o){s.preventDefault();k.preventDefault();k.stopPropagation()}},pasteManipulateCallback:function(e,f){if(f&&f.querySelectorAll){var j=f.querySelectorAll("img");if(j){for(var g=0;g<j.length;g++){j[g].setAttribute("style","-x-ignore: 1");if(j[g].src.match(/^data:image\/([a-z0-9_-]+);([a-z0-9_-]+),([\W\w]+)$/i)){var h=this.pasteImageCounter++;j[g].setAttribute("data-paste-id",h);if(!this.uploadPastedImage(e,h,RegExp.$1,RegExp.$3,RegExp.$2)){j[g].parentNode.removeChild(j[g])}}}}}},pasteCleanUpCallback:function(j,f,g){var i=f.browser("msie")&&a.all;
g=c.trim(g);var k=g.match(/<[a-zA-Z0-9-]+[^>]* data-redactor="1"/);g=g.replace(/^<div[^>]* data-redactor-wrapper="1"[^>]*>([\w\W]+)<\/div>$/,"$1");if(f.browser("mozilla")){g=g.replace(/<br>$/gi,"")}g=g.replace(/<img[^>]+src="webkit-fake-url:[^"]*"[^>]*>/ig,"");g=g.replace(/<style[^>]*>([\w\W]*?)<\/style>/gi,"");g=c.trim(g);if(g.match(/<p(\s|>)/i)&&!g.match(/^<(ul|ol|li|p|div|table|tr|th|td|pre|h\d)(\s|>)/)){g="<p>"+g.replace(/(<p(\s|>))/,"</p>$1")}g=g.replace(/<\/p>/gi,"</p><p>"+(i?"":"<br>")+"<span><span></span></span></p>");
g=g.replace(/<p>(<br>)?<span><span><\/span><\/span><\/p>$/,"");g=g.replace(/<div/gi,"<p").replace(/<\/div>/g,"</p>");g=g.replace(/<p([^>]*)>(\s*|<br\s*\/?>|&nbsp;)<\/p>/gi,"<p$1>"+(i?"":"<br>")+"<span><span></span></span></p>");g=g.replace(/(<[a-zA-Z0-9-]+[^>]*) data-redactor="1"/g,"$1");g=g.replace(/<span[^>]+style="[^"]*white-space:\s*pre[^"]*"[^>]*>([\w\W]+?)<\/span>/g,function(e,l){return l.replace(/\t/g,"    ").replace(/  /g,"&nbsp; ").replace(/  /g,"&nbsp; ")});g=g.replace(/([\w\W]|^)<a\s[^>]*data-user="(\d+, [^"]+)"[^>]*>([\w\W]+?)<\/a>/gi,function(m,n,l,o){var e=l.split(", ");
if(!parseInt(e[0],10)){return m}return n+(n=="@"?"":"@")+e[1].replace(/^@/,"")});g=g.replace(/(<img\s[^>]*)src="[^"]*"(\s[^>]*)data-url="([^"]+)"/gi,function(e,m,n,l){return m+'src="'+l+'"'+n});g=g.replace(/((&nbsp;){2,})( )?/gi,function(m,e,q,p){var o=e.length/6;if(p&&p.length){o++}var l="";for(var n=2;n<=o;n+=2){l+="&nbsp; "}if(o%2==1){l+="&nbsp;"}return l});if(!k){var h=function(m,n,l){var e;do{e=m.replace(n,l);if(e==m){break}m=e}while(true);return e};g=h(g,/<input[^>]*>/gi,"");g=h(g,/<textarea[^>]*>/gi,"");g=h(g,/<select[^>]*>([\w\W]*?)<\/select>/gi,"");
g=h(g,/<button[^>]*>([\w\W]*?)<\/button>/gi,"");g=h(g,/<article[^>]*>([\w\W]*?)<\/article>/gi,"$1");g=h(g,/<blockquote[^>]*>([\w\W]*?)<\/blockquote>/gi,"$1");g=h(g,/<del[^>]*>([\w\W]*?)<\/del>/gi,"$1");g=h(g,/<ins[^>]*>([\w\W]*?)<\/ins>/gi,"$1");g=h(g,/<sub[^>]*>([\w\W]*?)<\/sub>/gi,"$1");g=h(g,/<sup[^>]*>([\w\W]*?)<\/sup>/gi,"$1");g=h(g,/<code[^>]*>([\w\W]*?)<\/code>/gi,"$1");g=h(g,/<tr[^>]*>([\w\W]*?)<\/tr>/gi,"<p>$1</p>");g=h(g,/<td[^>]*>([\w\W]*?)<\/td>/gi,"$1 ");g=h(g,/<th[^>]*>([\w\W]*?)<\/th>/gi,"<b>$1</b> ");g=h(g,/<tbody[^>]*>([\w\W]*?)<\/tbody>/gi,"$1 ");
g=h(g,/<table[^>]*>([\w\W]*?)<\/table>/gi,"$1 ");g=g.replace(/<h1[^>]*>([\w\W]+?)<\/h1>/ig,'<p>[paste:font size="6"]<b>$1</b>[/paste:font]</p>');g=g.replace(/<h2[^>]*>([\w\W]+?)<\/h2>/ig,'<p>[paste:font size="5"]<b>$1</b>[/paste:font]</p>');g=g.replace(/<h3[^>]*>([\w\W]+?)<\/h3>/ig,'<p>[paste:font size="4"]<b>$1</b>[/paste:font]</p>');g=g.replace(/<h4[^>]*>([\w\W]+?)<\/h4>/ig,'<p>[paste:font size="3"]<b>$1</b>[/paste:font]</p>');g=g.replace(/<h5[^>]*>([\w\W]+?)<\/h5>/ig,"<p><b>$1</b></p>");g=g.replace(/<h6[^>]*>([\w\W]+?)<\/h6>/ig,"<p><b>$1</b></p>");
g=g.replace(/<pre[^>]*>([\w\W]+?)<\/pre>/ig,function(m,l){var e="";if(!l.length){e="<p></p>"}else{e="<p>"+l.replace(/\r?\n/g,"</p><p>")+"</p>";e=e.replace(/\t/g,"    ").replace(/<p> /g,"<p>&nbsp;").replace(/  /g,"&nbsp; ").replace(/  /g," &nbsp;").replace(/<span[^>]*>(&nbsp;|<br>)<\/span>/gi,"$1");e=e.replace(/((&nbsp;){2,})( )?/gi,function(p,n,t,s){var r=n.length/6;if(s&&s.length){r++}var o="";for(var q=2;q<=r;q+=2){o+="&nbsp; "}if(r%2==1){o+="&nbsp;"}return o})}return e.replace(/<p([^>]*)>(\s*|<br\s*\/?>|&nbsp;)<\/p>/gi,"<p$1>"+(i?"":"<br>")+"<span><span></span></span></p>")
})}if(f.$editor.data("xenForoElastic")){setTimeout(function(){f.$editor.data("xenForoElastic")()},0)}if(!g.match(/<(?!br\s*\/?)([a-z0-9-]+)(\s|\/|>)/i)&&g.match(/<br\s*\/?>/i)){g="<p>"+g.replace(/<br\s*\/?>\s*/ig,"</p><p>")+"</p>";g=g.replace(/<p><\/p>/ig,"<p>"+(i?"":"<br>")+"<span><span></span></span></p>")}if(k){g=g.replace(/<span><span><\/span><\/span>/gi,"");j.preventDefault()}return g},uploadPastedImage:function(p,o,s,n,h){var j=p.$box.closest("form").find(".AttachmentUploader");if(!j.length){return false}if(this.$textarea.hasClass("NoAttachment")){return false
}try{var g=new FormData();if(typeof(n)=="string"){var l;if(h=="base64"){l=atob(n)}else{l=unescape(n)}var r=[];for(var m=0;m<l.length;m++){r.push(l.charCodeAt(m))}n=new Blob([new Uint8Array(r)],{type:"image/"+s})}var k=new Date(),f="upload_"+k.getFullYear()+"-"+(k.getMonth()+1)+"-"+k.getDate()+"_"+k.getHours()+"-"+k.getMinutes()+"-"+k.getSeconds()+"."+s;g.append("upload",n,f);g.append("filename",f);g.append("_xfToken",XenForo._csrfToken);g.append("_xfNoRedirect","1");j.find(".HiddenInput").each(function(){var e=c(this);g.append(e.data("name"),e.data("value"))
})}catch(q){return false}var t=this;c.ajax({url:XenForo.canonicalizeUrl(j.data("action"),XenForo.ajaxBaseHref),method:"POST",dataType:"json",data:g,processData:false,contentType:false}).done(function(e){if(!t.$textarea.data("redactor")){return}var i=t.$textarea.getEditor().find("img[data-paste-id="+o+"]");if(XenForo.hasResponseError(e)){i.remove()}else{i.data("paste-id","").attr("src",e.viewUrl).attr("alt","attachFull"+e.attachment_id).addClass("attachFull");j.trigger({type:"AttachmentUploaded",ajaxData:e})}}).fail(function(v){t.$textarea.getEditor().find("img[data-paste-id="+o+"]").remove();
try{var i=c.parseJSON(v.responseText);if(i&&XenForo.hasResponseError(i)){}}catch(u){}});return true},getText:function(e,f){var g=RELANG.xf||RLANG;if(typeof g[e]=="string"){return g[e]}return f||e}};XenForo.BbCodeWysiwygEditor_EXTEND=XenForo.BbCodeWysiwygEditor_EXTEND||{};XenForo.register("textarea.BbCodeWysiwygEditor","XenForo.BbCodeWysiwygEditor")}(jQuery,this,document);