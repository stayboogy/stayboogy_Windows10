'use strict';var XFMG=window.XFMG||{};
!function(g,k,h,l){XF.Inserter=XF.extend(XF.Inserter,{__backup:{_applyAppend:"__applyAppend"},_applyAppend:function(a,b,c){if(0>[".js-yourMediaList",".js-yourAlbumsList",".js-browseMediaList",".js-browseAlbumsList"].indexOf(a))this.__applyAppend(a,b,c);else{var e=b.find(".itemList-item--placeholder"),d=c.children();e.length?(d.addClass("itemList-item--placeholder--temp"),this.__applyAppend(a,b,c),setTimeout(function(){d.removeClass("itemList-item--placeholder--temp");e.remove();XF.layoutChange()},
10)):this.__applyAppend(a,b,c)}}});XFMG.editorButton={init:function(){XFMG.editorButton.initializeDialog();XF.EditorHelpers.dialogs.gallery=new XFMG.EditorDialogGallery("gallery");g.FE.COMMANDS.xfCustom_gallery&&(g.FE.COMMANDS.xfCustom_gallery.callback=XFMG.editorButton.callback)},initializeDialog:function(){XFMG.EditorDialogGallery=XF.extend(XF.EditorDialog,{cache:!1,$container:null,_init:function(a){a=a.$container;a.on("change",".js-mediaPicker",XF.proxy(this,"pick"));this.$container=a;g("#xfmg_editor_dialog_form").submit(XF.proxy(this,
"submit"))},_afterShow:function(a){this.tabCounts={yourMedia:0,yourAlbums:0,browseMedia:0,browseAlbums:0}},pick:function(a){var b=this.$container.find(a.currentTarget);a=b.is(":checked");b=b.parent();a?this.checked(b):this.unchecked(b)},checked:function(a,b){a.addClass("is-selected");b=a.closest("ul > li.is-active");var c=this.$container.find(b.data("tab"));b=c.attr("id");c.hasClass("has-selected")||c.addClass("has-selected");var e=this.$container.find(".js-embedValue"),d=JSON.parse(e.val()),f=a.data("type");
a=a.data("id");a=f+"-"+a;d.hasOwnProperty(a)||(d[a]=1,a=c.find(".js-tabCounter"),this.tabCounts[b]+=1,a.text(this.tabCounts[b]),e.val(JSON.stringify(d)))},unchecked:function(a,b){a.removeClass("is-selected");b=a.closest("ul > li.is-active");b=this.$container.find(b.data("tab"));var c=b.attr("id"),e=this.$container.find(".js-embedValue"),d=JSON.parse(e.val()),f=a.data("type");a=a.data("id");a=f+"-"+a;d.hasOwnProperty(a)&&(delete d[a],a=b.find(".js-tabCounter"),--this.tabCounts[c],this.tabCounts[c]?
a.text(this.tabCounts[c]):(a.text(0),b.removeClass("has-selected")),e.val(JSON.stringify(d)))},submit:function(a){a.preventDefault();a=this.ed;var b=this.overlay,c=this.$container.find(".js-embedValue");c=JSON.parse(c.val());var e="",d;for(d in c)if(c.hasOwnProperty(d)){var f=d.split("-");e+=XF.htmlspecialchars("[GALLERY="+f[0]+", "+parseInt(f[1])+"][/GALLERY]");e+="<p><br></p>"}a.selection.restore();a.html.insert(e);"function"===typeof XF.EditorHelpers.normalizeAfterInsert&&XF.EditorHelpers.normalizeAfterInsert(a);
b.hide()}})},callback:function(){XF.EditorHelpers.loadDialog(this,"gallery")}};g(h).on("editor:first-start",XFMG.editorButton.init)}(jQuery,window,document);
