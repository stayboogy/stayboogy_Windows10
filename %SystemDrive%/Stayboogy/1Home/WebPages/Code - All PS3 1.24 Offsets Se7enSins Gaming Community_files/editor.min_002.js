var XAAMS=window.XAAMS||{};
!function(h,m,l,n){XF.Inserter=XF.extend(XF.Inserter,{__backup:{_amsApplyAppend:"__amsApplyAppend"},_amsApplyAppend:function(a,d,b){if(0>".js-yourArticlesList .js-yourPagesList .js-yourSeriesList .js-browseArticlesList .js-browsePagesList .js-browseSeriesList".split(" ").indexOf(a))this.__amsApplyAppend(a,d,b);else{var c=d.find(".amsArticleList-item--placeholder"),e=b.children();c.length?(e.addClass("amsArticleList-item--placeholder--temp"),this.__amsApplyAppend(a,d,b),setTimeout(function(){e.removeClass("amsArticleList-item--placeholder--temp");
c.remove();XF.layoutChange()},10)):this.__amsApplyAppend(a,d,b)}}});XAAMS.editorButton={init:function(){XAAMS.editorButton.initializeDialog();XF.EditorHelpers.dialogs.ams=new XAAMS.EditorDialogAms("ams");h.FE.COMMANDS.xfCustom_ams&&(h.FE.COMMANDS.xfCustom_ams.callback=XAAMS.editorButton.callback)},initializeDialog:function(){XAAMS.EditorDialogAms=XF.extend(XF.EditorDialog,{cache:!1,$container:null,_init:function(a){a=a.$container;a.on("change",".js-articlesPicker",XF.proxy(this,"pick"));this.$container=
a;h("#xa_ams_editor_dialog_form").submit(XF.proxy(this,"submit"))},_afterShow:function(a){this.tabCounts={yourArticles:0,yourPages:0,yourSeries:0,browseArticles:0,browsePages:0,browseSeries:0}},pick:function(a){var d=this.$container.find(a.currentTarget);a=d.is(":checked");d=d.parent();a?this.checked(d):this.unchecked(d)},checked:function(a,d){a.addClass("is-selected");var b=a.closest("ul > li.is-active"),c=this.$container.find(b.data("tab"));b=c.attr("id");c.hasClass("has-selected")||c.addClass("has-selected");
var e=this.$container.find(".js-embedValue"),g=JSON.parse(e.val()),f=a.data("type"),k=a.data("id");f=f+"-"+k;g.hasOwnProperty(f)||(g[f]=1,c=c.find(".js-tabCounter"),this.tabCounts[b]+=1,c.text(this.tabCounts[b]),e.val(JSON.stringify(g)))},unchecked:function(a,d){a.removeClass("is-selected");var b=a.closest("ul > li.is-active");b=this.$container.find(b.data("tab"));var c=b.attr("id"),e=this.$container.find(".js-embedValue"),g=JSON.parse(e.val()),f=a.data("type"),k=a.data("id");f=f+"-"+k;g.hasOwnProperty(f)&&
(delete g[f],f=b.find(".js-tabCounter"),--this.tabCounts[c],this.tabCounts[c]?f.text(this.tabCounts[c]):(f.text(0),b.removeClass("has-selected")),e.val(JSON.stringify(g)))},submit:function(a){a.preventDefault();a=this.ed;var d=this.overlay,b=this.$container.find(".js-embedValue");b=JSON.parse(b.val());var c="",e;for(e in b)if(b.hasOwnProperty(e)){var g=e.split("-");c+=XF.htmlspecialchars("[AMS="+g[0]+", "+parseInt(g[1])+"][/AMS]");c+="<p><br></p>"}a.selection.restore();a.html.insert(c);d.hide()}})},
callback:function(){XF.EditorHelpers.loadDialog(this,"ams")}};h(l).on("editor:first-start",XAAMS.editorButton.init)}(jQuery,window,document);